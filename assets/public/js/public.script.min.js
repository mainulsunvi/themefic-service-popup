;(function($) {

    const local_data = tfsp_data;

    $(document).ready(function(e) {
        if ($(".tfsp-checkout-container")) {
            $(".tfsp-checkout-container").delay(local_data.tfsp_popup_delay).show(0)
        }
    })

    // Click Cross to Hide Popup
    $(document).ready(function() {
        $(".tfsp-checkout-popup-cross span").on('click', function(e) {
            $(".tfsp-checkout-container").hide()
        })
    })

    // Click show other service textbox
    $("input[type*=checkbox]").on("click", function(e) {
        if($(this).is(":checked") && $(this).attr("name") == "tfsp-other-textarea") {
            $(document).find(".tfsb-popup-textarea").show()
        } else {
            $(document).find(".tfsb-popup-textarea").hide()
        }
    })

    
    // Click submit to get the service titles
    $(".popup-submit-button").on("click", function(e) {
        var services = []
        $(".tf-single-tour-extra").each(function(value, key) {
            if($(key).find("input[type*=checkbox]").is(":checked")){
                if($(key).find('input[type*=checkbox]').prevObject.find(".tfsp-service-title").text() == "Other Service") {
                    services.push( $(key).find(".tfsb-popup-textarea").val() )
                } else {
                    services.push( $(key).find('input[type*=checkbox]').prevObject.find(".tfsp-service-title").text() )
                }
            }
        })

        var services_str = services.join("^")

        $.ajax({
            type: 'post',
            url: local_data.ajax_url,
            // nonce: local_data.nonce,
            data: {
                action: "tfsp_wc_cart_meta",
                tfsp_services: services_str
            },
            success: function (response) {
                $(document).find(".services").text(services)
                console.log(response)
            },
            error: function (response) {
                console.log(response);
            },
            complete: function(response) {
                $(document).find(".tfsp-checkout-container").hide()
                $(document).find(".order-total").show()
            }
        })
    })
})(jQuery)